\chapter{
  Application
 }
\minitoc%

\section{Généralités}

\subsection{Estimation adaptative informelle}
\input{content/chapter_2/01-fda_essentiel/01-fda_essentiel-01-estim_adapt_informel.tex}
\subsection{Les estimateurs}

\info{ Plus de précisions théoriques sur les estimateurs utilisés sont disponibles dans l'annexe \ref{annexe:estim_adapt}.}

On utilisera les estimateurs considérés par MPV \cite{maissoro-SmoothnessFTSweakDep} pour la fonction moyenne :

\bigskip

\noindent On notera l'indicatrice de l'évènement \og il y a suffisamment de points autour de $t$ pour le lissage à noyaux de la courbe $i$ \fg : $\pi_i(t \, | \, h)$\footnote{On ne demande la présence que d'un unique point, un autre seuil plus strict peut être fixé. Il a été aperçu empiriquement que l'amélioration de l'estimation n'est pas significative, un point suffit pour éviter la dégénérescence.}.

\noindent Le nombre d'observations exploitables dans la bande $J_\Delta$ est donc : $P_N^* =P_N(t \, | \, h_\mu^*(\Delta^*)) = \sum\limits_{i=1}^N \pi_i(t \, | \, h_\mu^*(\Delta^*))$, et de manière équivalente on obtient le nombre d'observations exploitables pour l'estimation conjointe sur les courbes $i$ et $i + \ell$ en $t$: $P_{i,\ell}^*$.

\begin{align}
	\widehat{\mu^*_{\textsf{adapt}}}(t)              & = \frac 1 {P_N^*} \sum_{i=1}^N \left[\pi_i \cdot \widehat X^{[NW]}_i\right]\left(\, t \, | \, h^*_\mu(\Delta^*) \, \right) \\
	\widehat {\gamma^*_{\textsf{adapt}}}(s, t, \ell) & = \frac 1 {P^*_{i, \ell}}\sum_{i=1}^{N- \ell} \left[
		\left[\pi_i \cdot \widehat X^{[NW]}_i\right]\left(\, s \, | \, h^*_\mu(\Delta^*) \, \right) \left[\pi_{i + \ell} \cdot \widehat X^{[NW]}_{i + \ell}\right]\left(\, t \, | \, h^*_\mu(\Delta^*) \, \right)
		\right]                                                                                                                                                                       % \\
	% \widehat {C^*_{\textsf{adapt}}}(s,t)             & = \widehat {\gamma^*_{\textsf{adapt}}}(s, t, \ell) -
	% \widehat{\mu^*_{\textsf{adapt}}}(s)\widehat{\mu^*_{\textsf{adapt}}}(t)
\end{align}

On établit désormais si la procédure de détermination du $\Delta$ établie en section [\ref{sec:determination-delta}] permet bel et bien d'obtenir une bonne estimation des paramètres de régularité sur de nouvelles données générées.

\section{Contrôle de la procédure sur des données simulées}

Il est important que les données de test n'aient pas été utilisées pour déterminer la procédure. Pour vérifier que la procédure fonctionne comme prévu, on génère de nouvelles données aux caractéristiques suivantes :


\begin{table}[H]
	\centering
	\begin{tabularx}{\textwidth}{XXXX}
		\toprule
		\textbf{Nombre moyen d'observations par courbe}     & \textbf{symbole}                & \textbf{variation} & \textbf{valeur}                                           \\
		\bottomrule
		\multirow{3}{\hsize}{Nombre moyen d'observations}   & \multirow{3}{\hsize}{$\lambda$} & sparse             & 80                                                        \\
		                                                    &                                 & moyen              & 180                                                       \\
		                                                    &                                 & dense              & 300                                                       \\
		\midrule
		\multirow{3}{\hsize}{Nombre de courbes}             & \multirow{3}{\hsize}{$N$}       & sparse             & 100                                                       \\
		                                                    &                                 & moyen              & 200                                                       \\
		                                                    &                                 & dense              & 300                                                       \\
		\midrule
		Nombre de simulations de monte carlo                & $mc$                            &                    & 200                                                       \\
		\midrule
		Points d'estimation de la régularité                & $\vec t$                        &                    & $[0.3, 0.6, 0.8]$                                         \\
		\midrule
		\multirow{2}{\hsize}{Fonction de Hurst}             & $H_1$                           & même que sim       & $t \mapsto H^{[0.4, 0.8, 5, 0.5]}_{\textsf{logistic}}(t)$ \\
		                                                    & $H_2$                           & pente plus abrupte & $t \mapsto H^{[0.4, 1, 16, 0.6]}_{\textsf{logistic}}(t)$  \\
		\\
		\multirow{2}{\hsize}{Valeurs de régularité testées} & $H_1\bigl( \, \vec t \, \bigr)$ & même que sim       & $\bigl[ \, 0.51, 0.65, 0.73 \, \bigr]$                    \\
		                                                    & $H_2\bigl( \, \vec t \, \bigr)$ & pente plus abrupte & $\bigl[ \, 0.40, 0.70, 0.98 \, \bigr]$                    \\
		\midrule
		constante de régularité locale                      & $L_t$                           & constante          & 3                                                         \\
		\bottomrule
	\end{tabularx}
	\caption{Paramètres de simulation des données de test}
	\label{tab:sim_test_params}
\end{table}

\noindent Puis on estimera la régularité de chacune de ces courbes, et on comparera les résultats obtenus avec les valeurs théoriques.

\subsection{Détermination du $\Delta$ en utilisant la procédure}

Nous choisissons, en accord avec la section précédente, le $\Delta$ suivant :

\begin{equation*}
	\Delta^{proc} = 15\% \textsf{ du support}
\end{equation*}

\subsection{Estimation de la fonction moyenne}

On compare désormais les fonctions moyennes estimées de façon adaptative avec la fonction moyenne théorique en ayant effectué une estimation de la régularité avec $\Delta = \Delta^{proc}$ et $h = h^{[cv(\widehat \lambda)]}$.

\editlater{graphe de la fonction moyenne estimée contre la véritable fonction moyenne}

\subsection{Conclusion sur la qualité de la détermination du $\Delta$ via l'utilisation de la procédure}

En fonction de l'application souhaitée, il peut être plus adapté de s'intéresser à un critère global qui prend en compte l'ensemble de l'intervalle $\mathcal T$, ou un critère local qui a d'autant plus de sens du fait que l'on prend en compte la régularité locale des trajectoires.

\bigskip

\noindent De la même manière que dans l'annexe \ref{annexe:choix-du-rique}, on retire sur les 200 échantillons de monte carlo simulés, les échantillons \og extrêmes \fg où une observation peut potentiellement faire exploser le risque (auquel cas on rappelle que l'on conseille la méthode de Golovkine par la statistique d'ordre si les résultats sont insatisfaisants sur le voisinage problématique). On note $\textsf{mc}_{Ret}$ le nombre de simulations de monte carlo retenues dans le calcul après filtrage des \og extrêmes \fg.

\bigskip

\noindent Les risques affichés par la suite sont pour $N=200$, $\lambda = 180$.\footnote{Les tableaux de risque pour les autres valeurs mentionnées précédemment sont disponibles en annexe} On considère l'estimation du couple 

\begin{minipage}{0.45\textwidth}
\begin{equation*}
\widetilde \thetaB = \begin{bmatrix} \widetilde \theta(t_1, t_3)\\ \widetilde \theta(t_2, t_3) \end{bmatrix}
\end{equation*}
\end{minipage}
\begin{minipage}{0.45\textwidth}
Que l'on estime avec $\widehat \thetaB = \begin{bmatrix} \widehat \theta(t_1, t_3)\\ \widehat \theta(t_2, t_3) \end{bmatrix}$ comme définis 
\end{minipage}

\bigskip

\subsubsection{Qualité d'estimation du couple d'incréments $\thetaB$ : risque relatif}

\begin{table}[H]
	\centering
	\begin{tabularx}{\linewidth}{|X|X|XX|X|X|}
		\toprule
		$t$                                  & $H_t$        & $\widehat{\mathcal R}(\Theta, \Delta)$ & $\textsf{mc}_{Ret}$ & $\mathbf{\operatorname{med}\widehat{\mathcal R}_{mc}(\Theta, \Delta)}$ & $\mathbf{\mathds V[\widehat{\mathcal R}_{mc}(\Theta, \Delta)]}$ \\
		\midrule
		\multirow{2}{\hsize}{Moins Régulier} & $H_1 : 0.51$ & 2.9 $\cdot 10^{-3}$                    & $\vdots$            & 2.3 $\cdot 10^{-3}$                                                      & 5.0 $\cdot 10^{-6}$
		\\
		                                     & $H_2 : 0.40$ & 7.8 $\cdot 10^{-3}$                    & $\vdots$            & 5.1 $\cdot 10^{-3}$                                                      & 1.1 $\cdot 10^{-4}$
		\\
		\midrule
		\multirow{2}{\hsize}{Inflexion}      & $H_1 : 0.65$ & 9.0 $\cdot 10^{-5}$                    & $\vdots$            & 4.9 $\cdot 10^{-5}$                                                      & 1.2 $\cdot 10^{-8}$
		\\
		                                     & $H_2 : 0.70$ & 1.5 $\cdot 10^{-3}$                    & 198 (/200)          & 5.0 $\cdot 10^{-5}$                                                      & 2.3 $\cdot 10^{-4}$
		\\
		\midrule
		\multirow{2}{\hsize}{Plus régulier}  & $H_1 : 0.73$ & 1.1 $\cdot 10^{-4}$                    & $\vdots$            & 6.7 $\cdot 10^{-5}$                                                      & 1.5 $\cdot 10^{-8}$
		\\
		                                     & $H_2 : 0.98$ & 2.3 $\cdot 10^{-3}$                    & $\vdots$            & 7.8 $\cdot 10^{-5}$                                                      & 3.1 $\cdot 10^{-4}$
		\\
		\bottomrule
	\end{tabularx}
\end{table}


\chk{On peut constater que les risques relatifs observés sur l'estimation du couple $\thetaB$ pour de tous nouveaux paramètres de simulation sur lesquels la procédure de sélection du $\Delta$ n'a pas été déterminée ($H_2$) sont aussi très bons ce qui donne confiance en la procédure.}

\subsubsection{Qualité d'estimation de la fonction moyenne : Critère Global}

\begin{table}[H]
	\centering
	\begin{tabularx}{\linewidth}{|X|X|X|X|X|X|X|}
		\toprule
		$t$                                        & $H$   & $\widehat{\mathcal R}$ avec $\mathcal R$ = MISE & $\mathbf{\mathds V[\widehat{\mathcal R}_{mc}]}$ & $\mathbf{\operatorname{med}(\widehat{\mathcal R}_{mc})}$ & $\min \widehat{\mathcal R}(t)$ & $\max \widehat{\mathcal R}(t)$ \\
		\midrule
		\multirow{2}{\hsize}{$\mathcal T = [0,1]$} & $H_1$ &                                                 &                                                 &                                                          &                                &
		\\
		                                           & $H_2$ &                                                 &                                                 &                                                          &                                &
		\\
		\bottomrule
	\end{tabularx}
\end{table}

\subsubsection{Qualité d'estimation de la fonction moyenne : Critère Local}

\begin{table}[H]
	\centering
	\begin{tabularx}{\linewidth}{|X|X|X|X|X|}
		\toprule
		$t$                                  & $H_t$        & $\widehat{\mathcal R}(t)$ avec $\mathcal R$ = MSE & $\mathbf{\operatorname{med}(\widehat{\mathcal R}_{mc}(t))}$ & $\mathbf{\mathds V[\widehat{\mathcal R}_{mc}(t)]}$
		\\
		\midrule
		\multirow{2}{\hsize}{Moins régulier} & $H_1 : 0.51$ &                                          &                                                             &
		\\
		                                     & $H_2 : 0.40$ &                                          &                                                             &
		\\
		\midrule
		\multirow{2}{\hsize}{Inflexion}      & $H_1 : 0.65$ &                                          &                                                             &
		\\
		                                     & $H_2 : 0.70$ &                                          &                                                             &
		\\
		\midrule
		\multirow{2}{\hsize}{Plus régulier}  & $H_1 : 0.73$ &                                          &                                                             &
		\\
		                                     & $H_2 : 0.98$ &                                          &                                                             &
		\\
		\bottomrule
	\end{tabularx}
\end{table}

Les résultats permettent de conclure sur la méthode de sélection du $\Delta$.

\section{
  Application sur les données réelles de courbes de charge éolienne et photovoltaïque
 }

\subsection{Présentation des jeux de données}

Les données que l'on traîte sont des courbes de charge provenants de différents moyens de production : éolien ou photovoltaïque. Nous modélisons le jeu de données de la façon suivante :

\bigskip

\noalign\begin{tabularx}{\textwidth}{XX}
	\toprule
	\textbf{Données éoliennes}                                                                                                                                                                                         \\
	\midrule
	support            & année identifiée comme $\mathcal T = [0,1]$                                                                                                                                                          \\
	modèle fonctionnel & $\forall i \in I \quad E_i : \func {\Omega \times [0,1]} {\mathds R_+} {(\omega, t)} {e_i(t)}$                                                                                                \\
	indices            & éolienne individuelle : $I = \bigl\{ \, \textsf{id du parc éolien} \,\bigr\}$                                                                                                                  \\
	\\
	observations       & $\widehat E = \bigl\{ \, (T_i[m], Y_i[m]) \, : \, i \in \intervaleint 1 N, m \in \intervaleint 1 {M_i} \bigr\}$ : $Y_i[m] = E_i\bigl( \, T_i[m] \, \bigr) + \eta_i\bigl[ m \bigr]$ \\
	\\
	erreur de mesure   & $(\eta_i[m])_{I\times\llbracket 1, M_i \rrbracket}$ : indépendants 2 à 2                                                                                                                                                                 \\
	\\
	dépendance         & données indépendantes car les éoliennes ne s'influencent pas sur leur production.                                                                                             \\
	\bottomrule
\end{tabularx}


Les résultats que nous allons désormais présenter concernent le jeu de données de production électrique de panneaux photovoltaïques. On dispose d'une courbe de charge d'un unique parc éolien. La courbe de charge a été observée toutes les demie-heures pendant un an. Nous sommes donc sur un schéma de \og common-design \fg. Etant donné la présence d'un \og cycle de production \fg qui semble se répéter chaque jour, on décide de les modéliser par des séries temporelles fonctionnelles. Chaque courbe représente une journée, on dipose donc de 365 courbes dont le support représente une journée. Pour résumer :

\noalign\begin{tabularx}{\textwidth}{XX}
	\toprule
	\textbf{Données Photovoltaïques}                                                                                                                                                                                   \\
	\midrule
	support            & heure du jour identifiée comme $\mathcal T = [0,1]$                                                                                                                                                          \\
	modèle fonctionnel & ${V}_i : \func {\Omega \times [0,1]} {\mathds R_+} {(\omega, t)} {v_i(t)}$                                                                                                                    \\
	indices            & jour de l'année : $I = \, \llbracket 1, 365 \rrbracket$                                                                                                                        \\
	\\
	observations       & $\widehat V = \bigl\{ \, (T_i[m], Z_i[m]) \, : \, i \in \intervaleint 1 N, m \in \intervaleint 1 {M_i} \bigr\}$ : $Z_i[m] = V_i\bigl( \, T_i[m] \, \bigr) + \nu_i\bigl[ m \bigr]$ \\
	\\
	erreur de mesure   & $\eta_i$ : indépendants 2 à 2                                                                                                                                                                 \\
	\\
	dépendance         & dépendance : même parc, courbes journalières cycliques, indice temporel, observation dans le temps                                                                                                                                             \\
	\bottomrule
\end{tabularx}

\begin{rem}
	On pourra constater que les données éoliennes et les données photovoltaïques rendent compte de la remarque faite en section \ref{sec:func_ts} : l'un des jeux de données est indexé sur le temps, l'autre sur un identifiant. De plus les données éoliennes présentent à la fois un indice et un support temporel.
\end{rem}


\subsection{Pré-traitement des données}

La manipulation des séries temporelle requiert la stationnarité. Hors, la moyenne de production électrique des panneaux solaires varie dans l'année (durée des journées, fréquence de pluies, ...). Ainsi on découpe le jeu de données selon la saison, dans la suite du rapport nous nous concentrerons sur la courbe de charge pendant la période estivale. (on pose donc $\bigl[ \, 21/06/2017, \, 22/09/2017 \, ] = \mathcal T \isdef \bigl[ 0, 1 \bigr]$)

\subsection{Pré-lissage et estimation de la régularité locale}

On effectue un lissage à noyaux en utilisant une fenêtre de lissage déterminée par validation croisée, dont la grille suit la même échelle que celle établie dans la section \ref{eq:h_cross_noyau_pre}.

\editlater{Montrer graphe de courbes non lissées et lissées}

On utilise la procédure de détermination du $\Delta$ déterminée auparavant pour estimer la régularité locale des données.

\subsection{Estimation de la fonction moyenne}

On détermine la fonction moyenne du processus en utilisant la méthode d'estimation adaptative proposée par \cite{maissoro-SmoothnessFTSweakDep}.


\section{Conclusion}
